# Hey API Configuration Notes

## Current Setup

We're using the **recommended approach** from hey-api documentation:

### 1. Generated Client
- Location: `src/lib/api/client.gen.ts`
- Auto-generated, don't edit directly
- Provides base client with interceptor support

### 2. Custom Wrapper
- Location: `src/lib/api-client.ts`
- **Safe from regeneration**
- Adds auth interceptor using native hey-api feature

### 3. Configuration
- File: `openapi-ts.config.ts`
- Uses plugin-based approach
- Client: `@hey-api/client-fetch`

## Why This Approach?

According to hey-api docs, the Fetch client natively supports interceptors:

```typescript
client.interceptors.request.use((request, options) => {
  request.headers.set('Authorization', `Bearer ${token}`);
  return request;
});
```

This is the **official way** to add authentication, so our implementation is correct!

## Alternative: Global Config

You could also use `setConfig()` for auth:

```typescript
client.setConfig({
  auth: () => Cookies.get(AUTH_COOKIE_NAME),
  baseUrl: 'http://localhost:8888/api',
});
```

But interceptors are more flexible for:
- Dynamic token reading
- Request/response transformation
- Error handling
- Logging

## Regeneration-Safe Pattern

✅ **Files that get overwritten:**
- `src/lib/api/client.gen.ts`
- `src/lib/api/sdk.gen.ts`
- `src/lib/api/types.gen.ts`

✅ **Files that are safe:**
- `src/lib/api-client.ts` (our custom wrapper)
- `src/lib/auth.tsx`
- All component files

✅ **How it works:**
1. Run `npm run generate-client`
2. Generated files are updated
3. `api-client.ts` imports generated client
4. `api-client.ts` adds interceptor
5. App uses enhanced client

## Plugin Configuration

```typescript
export default defineConfig({
  client: {
    bundle: true,
    name: '@hey-api/client-fetch',
  },
  plugins: [
    '@hey-api/sdk',
    '@hey-api/types',
  ],
  // ... other config
})
```

### Available Plugins

- `@hey-api/sdk` - Generate SDK functions
- `@hey-api/types` - Generate TypeScript types
- `@tanstack/react-query` - React Query integration
- `@tanstack/vue-query` - Vue Query integration
- `zod` - Zod validation schemas

## References

- [Fetch Client Docs](https://heyapi.dev/openapi-ts/clients/fetch.html)
- [Interceptors](https://heyapi.dev/openapi-ts/clients/fetch.html#interceptors)
- [Configuration](https://heyapi.dev/openapi-ts/configuration.html)
- [Plugins](https://heyapi.dev/openapi-ts/plugins.html)
